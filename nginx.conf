# 静态 & SPA
location / {
  try_files $uri $uri/ /index.html;
}

# 1) /auth/* -> /api/auth/*
location ^~ /auth/ {
  rewrite ^/auth/(.*)$ /api/auth/$1 break;
  proxy_pass         http://app:5055;
  proxy_http_version 1.1;
  proxy_set_header   Host              $host;
  proxy_set_header   X-Real-IP         $remote_addr;
  proxy_set_header   X-Forwarded-For   $proxy_add_x_forwarded_for;
  proxy_set_header   X-Forwarded-Proto $scheme;
}

# 2) 如果还有这些前缀，同样直转（按你后端实际是否带 /api 决定）
location ^~ /api/ {
  proxy_pass         http://app:5055;
  proxy_http_version 1.1;
  proxy_set_header   Host              $host;
  proxy_set_header   X-Real-IP         $remote_addr;
  proxy_set_header   X-Forwarded-For   $proxy_add_x_forwarded_for;
  proxy_set_header   X-Forwarded-Proto $scheme;
}

location ^~ /users/    { proxy_pass http://app:5055; proxy_set_header Host $host; }
location ^~ /bookings/ { proxy_pass http://app:5055; proxy_set_header Host $host; }

# （可选）静态资源缓存
location ~* \.(css|js|png|jpg|jpeg|gif|svg|ico|woff2?|ttf)$ {
  try_files $uri =404;
  expires 1h;
  access_log off;
}
